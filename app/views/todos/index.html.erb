<%= render :file => 'groups/header.html.erb' %>
<div id="maincontent-box">
	<div id="maincontent-head">
		<strong><%=h @group.name %> - To-Do List</strong>
	</div>
	<div id="maincontent-body">
	<div class="todonew">
		<% form_for([@group, Todo.new]) do |f| %>
		  <%= f.error_messages %>

		  <p>
			<%= f.label :task %><br />
			<%= f.text_field :task %>
		  </p>
		  <p>
			<%= f.label :duedate %><br />
			<%= f.date_select :duedate %>
		  </p>
		  <p>
			<%= f.submit 'Create' %>
		  </p>
		<% end %>
	</div>
	<div class="todonewshow">New Task</div>
	</div>
</div>
<div id="maincontent-box">
	<div id="maincontent-body">
		<table>
		  <tr>
			<th>Task</th>
			<th>Added on</th>
			<th>Due Date</th>
			<th>Status</th>
			<th>Added by</th>
			<th>Finished by</th>
		  </tr>

		<% @group.todos.each do |todo| %>
		  <tr>
			<td><%=h todo.task %></td>
			<td><% if todo.created_at > 48.hours.ago%>
				<%= time_ago_in_words(todo.created_at) %> ago
			<% else %>
				on <%= todo.created_at.strftime("%m/%d/%y") %>
			<% end %></td>
			<td><%=h todo.duedate %></td>
			<td><%= if todo.finished
					"finished"
				elsif todo.duedate < Date.today
					"expired"
				else
					"in progress"
				end %></td>
			<td><%=h User.find(todo.user_id).username %></td>
			<% if todo.finished_by != nil %>
				<td><%=h User.find(todo.finished_by).username %></td>
				<% else %>
				<td></td>
			<% end %>
			<td><%= if todo.finished
					link_to 'unmark finished', :controller => "todos",
									:action => "unfinish", :id => todo.id, :group_id => @group.id
				else
					link_to 'mark finished', :controller => "todos",
									:action => "finish", :id => todo.id, :group_id => @group.id
				end %></td>
			<td><%= link_to 'edit', edit_group_todo_path(@group, todo) %></td>
			<td><%= link_to 'delete', [@group, todo], :confirm => 'Are you sure?', :method => :delete %></td>
		  </tr>
		<% end %>

		</table>
	</div>
</div>
